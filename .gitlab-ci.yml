stages:
- build
- deploy

build:
  image: registry.gitlab.com/antoniocoratelli/docker-builder-as-a-service/cpp14-builder
  stage: build
  script:
  - mkdir build; cd build
  - cmake ..
  - make
  only:
  - master

cpplint:
  image: registry.gitlab.com/antoniocoratelli/docker-builder-as-a-service/google-cpplint
  stage: build
  script:
  - SOURCES=$(find examples/ -name '*.cpp')
  - INCLUDES=$(find include/ -name '*.h')
  - cpplint --linelength=120 $SOURCES $INCLUDES
  allow_failure: true

pages:
  image: registry.gitlab.com/antoniocoratelli/docker-builder-as-a-service/doxygen
  stage: deploy
  script:
  - cd doc; doxygen Doxyfile; cd ..
  - mv doc/html public
  artifacts:
    paths:
    - public
  only:
  - master

mirror:
  image: registry.gitlab.com/antoniocoratelli/docker-builder-as-a-service/ci-mirror
  stage: deploy
  script: ci-mirror git@github.com:antoniocoratelli/state-machine.git
  only:
  - master
